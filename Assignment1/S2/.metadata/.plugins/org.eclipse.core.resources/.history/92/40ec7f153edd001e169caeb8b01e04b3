.syntax unified
.thumb

#include "definitions.s"
#include "initialise.s"

.text
.global main

main:
	BL enable_peripheral_clocks

    // Button enable (input)
    LDR R2, =GPIOA         // Loading port A address into R0 register
    LDRB R3, [R2, #MODER]  // Loading the byte from GPIOA MODER (offset 0x00)
    AND R3, #0b11111100    // Bitmasking to change only the last two bits (bits 0 and 1)
    STRB R3, [R2, #MODER]  // Save back to GPIOA MODER

    //LED enable (output)
   LDR R4, =GPIOE          // Address of GPIOE
   LDR R5, [R2, #MODER]    // Loading the high half-word from the MODER register (offset 0x02)
   MOV R6, #0x5555         // Binary value of 01 (output mode) for each upper two bytes (0x5 = 0101)
   STRH R6, [R4, #MODER]   // Saving into MODER register

   MOV R7, #0              // Load LED pattern into a register

    B loop

loop:
    LDRB R3, [R2, #IDR]    // Read the input from GPIOA IDR
    ANDS R3, #0x01          // Check if button is on
    BEQ button_pressed      // Branch if button is pressed
    B loop

button_pressed:
    ORR R7, R7, #0b00000001 // Set the LED pattern
    STRB R7, [R4, #ODR + 1]     // Save the LED pattern
    B loop
